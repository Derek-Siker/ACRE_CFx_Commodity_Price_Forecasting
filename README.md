# ACRE_CFx_Commodity_Price_Forecasting
A plug-and-play notebook for commodity price forecasting that uses standard ML Pipeline template


- #### Introduction

    - In this project, a number of tree-based regressors are deployed to predict the monthly price direction and concurrent median spot price of a chosen commodity contract over a select period of time (the client will need to specify the type of contract or averaging method across contracts that should be used). 


- #### Data compatibility

    - This code will work for any market data ingested via Barchart to construct the target feature as well either Barchart or Oilworld physical contract data for input features. 

- #### Exploratory data analysis

    - Standard pandas profiling reports are provided along with basic summary statistics to inform skew and missingness in the data.


- #### Data wrangling and pre-processing

    - The current approach converts time series data into a usable format for a supervised machine learning problem and applies the following standard transformations:
       - Handling missing data (represented as NaNs or zeros) using forward-backfill mean imputation. This method can also be substituted for general mean imputation if required
       - Removal of data skew using log transformation
       - Normalization with sklearn MinMax scaling


- #### Feature engineering

    - Automated feature engineering is included in the template of this code. Examples are also provided for information that may be helpful to engineer into additional input features (consult with your CST, the client, and potentially use ENS Navigator to set up expert interviews for identifying targets specific to your use case). 

- #### Feature transformation

    - The option is provided to apply dimensionality reduction using the PCA algorithm from sklearn. The number of dimensions to be used should be specified by the user.


- #### Feature selection 

    - Feature selection defaults to the Boruta method and reverts to F-test selection if no features are initially chosen. Setting a lower iteration rate may also help to reduce run-time and expand the selection, but may also reduce model accuracy.

- #### Model selection and evaluation approach

    - A tree-based model is required to run the code (any type of ensemble or boosted-tree model is compatible but may require additional updates to params grid and confidence interval generator). Currently the model will default to sklearn's RandomForestRegressor.

    - Backtesting is applied using a time series GridSearch expanding window cross-validation approach - the training period must be specified by the user. The model will train up to each point in an expanding window and then make an out-of-sample prediction. These out-of-sample predictions are then collected into a final dataframe along with confidence intervals (currently generated by forestci). This dataframe is then further transformed to convert predictions from % difference between current and future median contract price into spot price predictions.

    - The model is evaluation using standard regression metrics (MAE, MAPE) as well as directional accuracy (precision, recall, and F1 scores). For directional accuracy the option is also provided for both binary and multi-class confusion matrices; the client will need to provide information on the cut-off points to be used for constructing classes. 


- #### Feature importance

    - A gini-importance score is used to rank and plot feature importances (using sklearn package)


- #### Final output and visualization

    - The final predictions, confidence intervals, and information related to actual price as well as % change in price are saved in both .csv and .xlsx format. 

    - Additionally, an ouptut file is provided in both .csv and .xlsx format for populating an MVP PowerBI Dashboard. In order to fully utilize the dashboard, output may also be required from the ACRE Commodity FX hedging optimization support tool.

    - A version of the dashboard is also in development that will only require price forecasting output from this notebook.
